<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>EXCEL ERP - Gestão</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* CSS específico para a sidebar igual à sua imagem */
        :root { --sidebar-bg: #0f172a; --active-yellow: #fbbf24; }
        body { display: flex; height: 100vh; background: #f8fafc; margin: 0; overflow: hidden; }
        .sidebar { width: 260px; background: var(--sidebar-bg); color: #cbd5e1; display: flex; flex-direction: column; }
        .nav-btn-dash { background: var(--active-yellow); color: #0f172a; padding: 12px; border-radius: 8px; font-weight: 700; display: flex; align-items: center; gap: 10px; text-decoration: none; margin: 20px 16px; }
        .nav-btn-dash.inactive { background: transparent; color: #cbd5e1; font-weight: 500; }
        .submenu { padding-left: 20px; }
        .sub-item { display: flex; align-items: center; padding: 10px; color: #94a3b8; text-decoration: none; position: relative; transition: 0.3s; }
        .sub-item:before { content: "•"; margin-right: 10px; font-size: 1.5rem; }
        .sub-item:hover, .sub-item.active { background: var(--active-yellow); color: #0f172a; border-radius: 6px; font-weight: 600; }
        .main-content { flex: 1; padding: 30px; overflow-y: auto; }
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .kpi-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div style="padding: 24px; color: white;"><h2>EXCEL ERP</h2></div>
        <div class="nav-menu">
            <a href="#" class="nav-btn-dash" id="btn-dash" onclick="trocarAba('dash')"><i class='bx bxs-dashboard'></i> Dashboard</a>
            <div style="padding: 10px 20px; font-weight: 600;">CADASTROS</div>
            <div class="submenu">
                <a href="#" class="sub-item" id="menu-cli" onclick="trocarAba('clientes')">Clientes</a>
                <a href="#" class="sub-item">Fornecedores</a>
            </div>
        </div>
    </aside>

    <main class="main-content">
        <div id="view-dash">
            <h1>Dashboard</h1>
            <div class="kpi-grid">
                <div class="kpi-card">Faturamento: <b>R$ 45.000</b></div>
                <div class="kpi-card">Clientes: <b id="dash-cli">0</b></div>
            </div>
            <div style="display: flex; gap: 20px;">
                <div style="flex: 2; background: white; padding: 20px;"><canvas id="revChart"></canvas></div>
                <div style="flex: 1; background: white; padding: 20px;"><canvas id="servChart"></canvas></div>
            </div>
        </div>

        <div id="view-clientes" style="display:none;">
            <div style="display:flex; justify-content:space-between;">
                <h1>Clientes</h1>
                <button onclick="document.getElementById('modal').style.display='flex'">+ Novo Cliente</button>
            </div>
            <table style="width: 100%; margin-top: 20px; background: white;">
                <thead><tr><th>Nome</th><th>Documento</th><th>Cidade</th><th>Ações</th></tr></thead>
                <tbody id="lista-clientes"></tbody>
            </table>
        </div>
    </main>

    <div id="modal" style="display:none; position:fixed; background:rgba(0,0,0,0.5); width:100%; height:100%; justify-content:center; align-items:center;">
        <div style="background:white; padding:30px; border-radius:10px;">
            <h3>Novo Cliente</h3>
            <form id="formCli">
                <input type="text" id="c_nome" placeholder="Nome" required><br><br>
                <input type="text" id="c_doc" placeholder="CPF/CNPJ"><br><br>
                <button type="submit">Salvar</button>
                <button type="button" onclick="document.getElementById('modal').style.display='none'">Fechar</button>
            </form>
        </div>
    </div>

    <script>
        function trocarAba(aba) {
            document.getElementById('view-dash').style.display = aba === 'dash' ? 'block' : 'none';
            document.getElementById('view-clientes').style.display = aba === 'clientes' ? 'block' : 'none';
            document.getElementById('btn-dash').className = aba === 'dash' ? 'nav-btn-dash' : 'nav-btn-dash inactive';
            if(aba === 'clientes') carregarClientes();
        }

        async function carregarClientes() {
            const res = await fetch('/api/clientes');
            const dados = await res.json();
            document.getElementById('dash-cli').innerText = dados.length;
            document.getElementById('lista-clientes').innerHTML = dados.map(c => `
                <tr>
                    <td>${c.nome}</td>
                    <td>${c.documento}</td>
                    <td>${c.cidade || '-'}</td>
                    <td><button onclick="excluir(${c.id})">Excluir</button></td>
                </tr>
            `).join('');
        }

        document.getElementById('formCli').addEventListener('submit', async (e) => {
            e.preventDefault();
            await fetch('/api/clientes', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ nome: document.getElementById('c_nome').value, documento: document.getElementById('c_doc').value })
            });
            document.getElementById('modal').style.display = 'none';
            carregarClientes();
        });

        async function excluir(id) {
            await fetch(`/api/clientes/${id}`, { method: 'DELETE' });
            carregarClientes();
        }

        window.onload = () => {
            new Chart(document.getElementById('revChart'), { type: 'line', data: { labels: ['Jan','Fev','Mar'], datasets: [{label: 'Vendas', data: [10,20,15], borderColor: '#1e3a8a'}] } });
            new Chart(document.getElementById('servChart'), { type: 'doughnut', data: { labels: ['A','B'], datasets: [{data: [70,30], backgroundColor: ['#1e3a8a','#fbbf24']}] } });
            carregarClientes();
        }
    </script>
</body>
</html>
