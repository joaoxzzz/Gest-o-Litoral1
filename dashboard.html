<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GestÃ£o Litoral - Dashboard</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Estilos embutidos para garantir a estrutura do dashboard */
        body { display: flex; background-color: #f8fafc; height: 100vh; overflow: hidden; }
        .sidebar { width: 260px; background-color: #0f172a; color: #94a3b8; display: flex; flex-direction: column; padding: 20px; }
        .main-content { flex: 1; padding: 30px; overflow-y: auto; }
        .card { background: white; padding: 20px; border-radius: 16px; display: flex; align-items: center; gap: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .charts-container { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 30px; }
        .chart-box { background: white; padding: 20px; border-radius: 16px; }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 16px; margin-top: 15px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #f1f5f9; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; border-radius: 16px; width: 400px; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2 style="color:white; margin-bottom:40px;">GestÃ£oLitoral</h2>
        <a href="index.html" style="color:#ef4444; text-decoration:none;"><i class='bx bx-log-out'></i> Sair</a>
    </div>
    <div class="main-content">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
            <h2>OlÃ¡, <span id="nomeUsuario">Admin</span> ðŸ‘‹</h2>
            <button class="btn-primary" style="width:auto; padding:0 20px;" onclick="abrirModal()">+ Novo Cliente</button>
        </div>
        <div class="charts-container">
            <div class="chart-box"><canvas id="revChart"></canvas></div>
            <div class="chart-box"><canvas id="servChart"></canvas></div>
        </div>
        <div class="card" style="display:block;">
            <h3>Clientes Recentes</h3>
            <table>
                <thead><tr><th>Nome</th><th>Documento</th><th>Telefone</th><th>AÃ§Ãµes</th></tr></thead>
                <tbody id="tabelaClientes"></tbody>
            </table>
        </div>
    </div>

    <div class="modal" id="modalCliente">
        <div class="modal-content">
            <h3 id="modalTitulo">Novo Cliente</h3>
            <form id="formCliente">
                <input type="hidden" id="c_id">
                <input type="text" id="c_nome" placeholder="Nome" required style="width:100%; margin-top:10px; padding:10px;">
                <input type="text" id="c_doc" placeholder="Documento" style="width:100%; margin-top:10px; padding:10px;">
                <input type="text" id="c_tel" placeholder="Telefone" style="width:100%; margin-top:10px; padding:10px;">
                <input type="text" id="c_cid" placeholder="Cidade" style="width:100%; margin-top:10px; padding:10px;">
                <div style="display:flex; gap:10px; margin-top:20px;">
                    <button type="button" onclick="fecharModal()" style="flex:1; padding:10px;">Cancelar</button>
                    <button type="submit" class="btn-primary" style="flex:1;">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.getElementById('nomeUsuario').innerText = localStorage.getItem('usuarioNome') || 'Admin';

        async function carregarClientes() {
            const res = await fetch('/api/clientes');
            const clientes = await res.json();
            const tbody = document.getElementById('tabelaClientes');
            tbody.innerHTML = clientes.map(c => `
                <tr>
                    <td>${c.nome}</td>
                    <td>${c.documento || '-'}</td>
                    <td>${c.telefone || '-'}</td>
                    <td>
                        <button onclick="editar(${c.id})" style="border:none; background:none; cursor:pointer;"><i class='bx bx-edit'></i></button>
                        <button onclick="excluir(${c.id})" style="border:none; background:none; cursor:pointer; color:red;"><i class='bx bx-trash'></i></button>
                    </td>
                </tr>`).join('');
        }

        function abrirModal() { document.getElementById('formCliente').reset(); document.getElementById('c_id').value = ''; document.getElementById('modalCliente').style.display = 'flex'; }
        function fecharModal() { document.getElementById('modalCliente').style.display = 'none'; }

        document.getElementById('formCliente').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('c_id').value;
            const dados = { nome: document.getElementById('c_nome').value, documento: document.getElementById('c_doc').value, telefone: document.getElementById('c_tel').value, cidade: document.getElementById('c_cid').value };
            const url = id ? `/api/clientes/${id}` : '/api/clientes';
            await fetch(url, { method: id ? 'PUT' : 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(dados) });
            fecharModal(); carregarClientes();
        });

        async function editar(id) {
            const res = await fetch('/api/clientes');
            const clientes = await res.json();
            const c = clientes.find(cli => cli.id == id);
            if (c) { document.getElementById('c_id').value = c.id; document.getElementById('c_nome').value = c.nome; document.getElementById('c_doc').value = c.documento; document.getElementById('c_tel').value = c.telefone; document.getElementById('c_cid').value = c.cidade; document.getElementById('modalCliente').style.display = 'flex'; }
        }

        async function excluir(id) { if(confirm('Excluir?')) { await fetch(`/api/clientes/${id}`, { method: 'DELETE' }); carregarClientes(); } }

        window.onload = () => {
            carregarClientes();
            new Chart(document.getElementById('revChart'), { type: 'line', data: { labels: ['Jan','Fev','Mar'], datasets: [{ label: 'Vendas', data: [12,19,3], borderColor: '#1e3a8a' }] } });
            new Chart(document.getElementById('servChart'), { type: 'doughnut', data: { labels: ['Aluguel', 'Venda'], datasets: [{ data: [70, 30], backgroundColor: ['#3b82f6', '#10b981'] }] } });
        };
    </script>
</body>
</html>
