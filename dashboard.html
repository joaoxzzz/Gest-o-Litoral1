<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gest√£o Litoral</title>
    
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --sidebar-bg: #0f172a; 
            --active-yellow: #fbbf24; 
            --bg-body: #f8fafc;
            --white: #ffffff;
            --text-dark: #1e293b;
            --btn-blue: #1e3a8a;
            --green: #10b981;
            --bg-green-light: #d1fae5;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { display: flex; background-color: var(--bg-body); height: 100vh; overflow: hidden; }

        /* Sidebar */
        .sidebar { width: 260px; background-color: var(--sidebar-bg); color: #94a3b8; display: flex; flex-direction: column; padding: 20px; }
        .logo { font-size: 1.4rem; font-weight: 700; color: var(--white); margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
        .logo i { color: var(--active-yellow); font-size: 1.8rem; }
        .menu { list-style: none; display: flex; flex-direction: column; gap: 10px; }
        .menu li a { display: flex; align-items: center; gap: 12px; padding: 14px 16px; text-decoration: none; color: #94a3b8; border-radius: 12px; font-weight: 500; }
        .menu li a:hover, .menu li a.active { background-color: var(--active-yellow); color: #0f172a; font-weight: 600; }
        .logout { margin-top: auto; }
        .logout a { color: #ef4444 !important; }

        /* Main */
        .main-content { flex: 1; padding: 30px; overflow-y: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: var(--white); padding: 20px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 20px; }
        .card-icon { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .icon-blue { background: #dbeafe; color: #1e40af; }
        .charts-container { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 30px; }
        .chart-box { background: white; padding: 20px; border-radius: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }

        /* Table */
        .recent-orders { background: var(--white); padding: 25px; border-radius: 16px; }
        .btn-add { background-color: var(--btn-blue); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { text-align: left; color: #64748b; font-weight: 600; padding: 15px 10px; border-bottom: 1px solid #e2e8f0; }
        td { padding: 15px 10px; color: var(--text-dark); border-bottom: 1px solid #f1f5f9; }
        .action-btn { background: none; border: none; cursor: pointer; font-size: 1.2rem; margin-right: 10px; color: #64748b; }
        .status { padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; background-color: var(--bg-green-light); color: var(--green); }

        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; border-radius: 16px; width: 400px; }
        .form-group { margin-bottom: 15px; }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; margin-top: 5px; }
        .modal-actions { display: flex; gap: 10px; margin-top: 20px; }
        .btn-save { flex: 1; background: var(--btn-blue); color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; }
        .btn-cancel { flex: 1; background: #e2e8f0; cursor: pointer; border: none; padding: 10px; border-radius: 8px; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="logo"><i class='bx bxs-building-house'></i><span>Gest√£oLitoral</span></div>
        <ul class="menu">
            <li><a href="#" class="active"><i class='bx bxs-dashboard'></i> Dashboard</a></li>
            <li class="logout"><a href="index.html"><i class='bx bx-log-out'></i> Sair</a></li>
        </ul>
    </div>

    <div class="main-content">
        <div class="header">
            <div class="user-info">
                <h2>Ol√°, <span id="nomeUsuario">Usu√°rio</span> üëã</h2>
                <p>Resumo dos seus im√≥veis hoje.</p>
            </div>
            <button class="btn-add" onclick="abrirModal()"><i class='bx bx-plus'></i> Novo Cliente</button>
        </div>

        <div class="cards-grid">
            <div class="card">
                <div class="card-icon icon-blue"><i class='bx bx-user'></i></div>
                <div class="card-info"><h3 id="totalClientes">0</h3><p>Total Clientes</p></div>
            </div>
        </div>

        <div class="charts-container">
            <div class="chart-box"><canvas id="revChart"></canvas></div>
            <div class="chart-box"><canvas id="servChart"></canvas></div>
        </div>

        <div class="recent-orders">
            <h3>Clientes Recentes</h3>
            <table>
                <thead>
                    <tr><th>Nome</th><th>Documento</th><th>Telefone</th><th>Status</th><th>A√ß√µes</th></tr>
                </thead>
                <tbody id="tabelaClientes"></tbody>
            </table>
        </div>
    </div>

    <div class="modal" id="modalCliente">
        <div class="modal-content">
            <h3 id="modalTitulo">Novo Cliente</h3>
            <form id="formCliente">
                <input type="hidden" id="c_id">
                <div class="form-group"><label>Nome</label><input type="text" id="c_nome" required></div>
                <div class="form-group"><label>Documento</label><input type="text" id="c_doc"></div>
                <div class="form-group"><label>Telefone</label><input type="text" id="c_tel"></div>
                <div class="form-group"><label>Cidade</label><input type="text" id="c_cid"></div>
                <div class="modal-actions">
                    <button type="button" class="btn-cancel" onclick="fecharModal()">Cancelar</button>
                    <button type="submit" class="btn-save">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.getElementById('nomeUsuario').innerText = localStorage.getItem('usuarioNome') || 'Admin';

        async function carregarClientes() {
            try {
                // CORRIGIDO: Link relativo
                const res = await fetch('/api/clientes');
                const clientes = await res.json();
                
                const tbody = document.getElementById('tabelaClientes');
                tbody.innerHTML = '';
                document.getElementById('totalClientes').innerText = clientes.length;

                clientes.forEach(c => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${c.nome}</td>
                        <td>${c.documento || '-'}</td>
                        <td>${c.telefone || '-'}</td>
                        <td><span class="status">Ativo</span></td>
                        <td>
                            <button class="action-btn" onclick="editar(${c.id})"><i class='bx bx-edit'></i></button>
                            <button class="action-btn" onclick="excluir(${c.id})"><i class='bx bx-trash'></i></button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) { console.error("Erro ao buscar clientes:", error); }
        }

        carregarClientes();

        const modalCli = document.getElementById('modalCliente');
        const formCli = document.getElementById('formCliente');

        function abrirModal() {
            formCli.reset();
            document.getElementById('c_id').value = '';
            document.getElementById('modalTitulo').innerText = 'Novo Cliente';
            modalCli.style.display = 'flex';
        }
        function fecharModal() { modalCli.style.display = 'none'; }

        formCli.addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('c_id').value;
            const dados = {
                nome: document.getElementById('c_nome').value,
                documento: document.getElementById('c_doc').value,
                telefone: document.getElementById('c_tel').value,
                cidade: document.getElementById('c_cid').value,
                tipo: 'Fisica'
            };

            // CORRIGIDO: Links relativos
            const url = id ? `/api/clientes/${id}` : '/api/clientes';
            const metodo = id ? 'PUT' : 'POST';

            await fetch(url, {
                method: metodo,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dados)
            });

            fecharModal();
            carregarClientes();
        });

        async function editar(id) {
            const res = await fetch('/api/clientes');
            const clientes = await res.json();
            const c = clientes.find(cli => cli.id == id);
            if (c) {
                document.getElementById('c_id').value = c.id;
                document.getElementById('c_nome').value = c.nome;
                document.getElementById('c_doc').value = c.documento;
                document.getElementById('c_tel').value = c.telefone;
                document.getElementById('c_cid').value = c.cidade;
                document.getElementById('modalTitulo').innerText = 'Editar Cliente';
                modalCli.style.display = 'flex';
            }
        }

        async function excluir(id) {
            if(confirm('Excluir este cliente?')) {
                // CORRIGIDO: Link relativo
                await fetch(`/api/clientes/${id}`, { method: 'DELETE' });
                carregarClientes();
            }
        }

        // Gr√°ficos (Mantidos)
        window.onload = () => {
            carregarClientes();
            new Chart(document.getElementById('revChart').getContext('2d'), { 
                type: 'line', 
                data: { labels: ['Jan','Fev','Mar','Abr','Mai'], datasets: [{ label: 'Vendas', data: [12,19,3,5,20], borderColor: '#1e3a8a', tension: 0.4 }] }, 
                options: { plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { grid: { display: false } } } } 
            });
            new Chart(document.getElementById('servChart').getContext('2d'), { 
                type: 'doughnut', 
                data: { labels: ['Aluguel', 'Venda'], datasets: [{ data: [70, 30], backgroundColor: ['#3b82f6', '#10b981'] }] }
            });
        }
    </script>
</body>
</html>